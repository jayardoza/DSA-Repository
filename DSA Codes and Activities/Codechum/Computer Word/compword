#include <stdio.h>
#include <stdbool.h>
#include "compword.h"

// Set the answer to 1 or 0 for a given question index
void setAnswer(CompWord* profile, int index, int value) {
    // Validate index (0-9 for 10 questions)
    if (index < 0 || index > 9) {
        return;
    }
    
    // Create a mask with 1 at the index position
    CompWord mask = 1 << index;
    
    if (value == 1) {
        // Set bit to 1 (yes)
        *profile = *profile | mask;
    } else {
        // Set bit to 0 (no)
        mask = ~mask;  // Invert mask to have 0 at index and 1 elsewhere
        *profile = *profile & mask;
    }
}

// Retrieve the answer for a given question index
int getAnswer(CompWord profile, int index) {
    // Validate index
    if (index < 0 || index > 9) {
        return 0;
    }
    
    // Create mask and check if bit is set
    CompWord mask = 1 << index;
    return (profile & mask) ? 1 : 0;
}

// Count how many answers are 1
int countYesAnswers(CompWord profile) {
    int count = 0;
    
    // Check each of the 10 bits (indices 0-9)
    for (int i = 0; i < 10; i++) {
        if (getAnswer(profile, i)) {
            count++;
        }
    }
    
    return count;
}

// Print all answers as a binary string
void printAnswers(CompWord profile) {
    // Print from highest index (9) to lowest (0) for left-to-right reading
    for (int i = 9; i >= 0; i--) {
        printf("%d", getAnswer(profile, i));
    }
    printf("\n");
}

// Compares how many matching answers the two respondents have
int compareProfiles(CompWord a, CompWord b) {
    int matching = 0;
    
    // Count positions where both profiles have the same answer
    for (int i = 0; i < 10; i++) {
        if (getAnswer(a, i) == getAnswer(b, i)) {
            matching++;
        }
    }
    
    return matching;
}

// Returns a new set containing all of the yes answers from both profiles
CompWord unionProfiles(CompWord a, CompWord b) {
    // Union: bitwise OR - a bit is 1 if it's 1 in either profile
    return a | b;
}

// Returns a new set containing all of the common yes answers from both profiles
CompWord intersectProfiles(CompWord a, CompWord b) {
    // Intersection: bitwise AND - a bit is 1 only if it's 1 in both profiles
    return a & b;
}

// Returns a new set containing the yes answers from a and the common answers they have with b
CompWord differenceProfiles(CompWord a, CompWord b) {
    // Difference: a XOR (a AND b) = a without the intersection
    // Alternative: a & ~b (yes in a but not in b)
    // But based on the sample output and description, it seems to be:
    // "yes answers from a and the common answers they have with b"
    // Looking at sample: Inie: 0100101011, Jobo: 0011110101
    // Difference: 0100001010
    // This appears to be (a & ~b) | (a & b) which is just a
    // Actually, it seems to be (a ^ b) & a? Let me check...
    
    // Based on the sample output, it seems to be: yes in a but no in b
    // Inie: positions with 1: 0,1,3,5,8
    // Jobo: positions with 1: 0,2,4,5,6,7
    // Difference: positions with 1: 1,3,8 (yes in Inie but not in Jobo)
    // So it's a & ~b
    
    return a & ~b;
}